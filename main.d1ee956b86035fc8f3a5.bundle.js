webpackJsonp([1,5],{194:function(t,e,i){"use strict";var n=i(287);i.d(e,"a",function(){return r});var r=function(){function t(e,i){this.angle=90,this.type=n.a.human,this.weapons=[],this.engine=e,this.position=i,this.id=t.idcount++}return t.prototype.maskEntity=function(){return this.isMasked=!0,this.setAnimation(),this},t.prototype.unmaskEntity=function(){return this.isMasked=!1,this.setAnimation(),this},t.prototype.listener=function(){},t.prototype.setAnimation=function(){var t=this.isMasked?"masked-":"",e=this.angle,i="";e>0?i=e<45?t+"right":e<135?t+"down":t+"left":(e=Math.abs(e),i=e<45?t+"right":e<135?t+"up":t+"left"),console.log("direction",i),this.engine.lookTo(this.sprite,i)},t.prototype.updateDirection=function(t,e){var i=Math.atan2(e.y-t.y,e.x-t.x)*(180/Math.PI);this.angle=i,this.isMasked=this.square.mask,this.setAnimation()},t.prototype.finishMoving=function(){return this.sprite.play("stand-down"),this},t.prototype.touched=function(t,e){return this},t.prototype.attack=function(t){return this.updateDirection(this.position,t.position),this},t.prototype.move=function(t,e){return this.updateDirection(this.position,t),this.position=t,this.engine.moveTo(this.sprite,this.position.x,this.position.y,e),this},t.idcount=0,t}()},195:function(t,e,i){"use strict";var n=i(183),r=i(356);i.n(r);i.d(e,"a",function(){return a});var a=function(){function t(t){this.http=t}return t.prototype.getMapJson=function(t){var e=this;return this.http.get("assets/tiles/"+t+".json").map(function(i){return e.buildMapResponse(t,i)})},t.prototype.buildMapResponse=function(t,e){var i=e.json(),n=i.tilesets,r=i.layers;return{name:t,data:e.json(),layers:r,tilesetImages:n.map(function(t){return{url:"assets/tiles/"+t.image,key:t.name}})}},t.prototype.LoadTileMap=function(t,e){e.load.tilemap(t.name,null,t.data,Phaser.Tilemap.TILED_JSON),t.tilesetImages.forEach(function(t){e.load.image(t.key,t.url)})},t.prototype.create=function(t,e,i){var n=e.add.tilemap(t.name,16,16);t.tilesetImages.forEach(function(t){e.load.image(t.key,t.url),n.addTilesetImage(t.key,t.key)});var r=new Map,a=new Map;t.layers.forEach(function(t){var e=n.createLayer(t.name);e.visible=1===t.opacity,r.set(t.name,e),i.add(e)});var s=t.data.tilesets;return s.map(function(t){return{firstgid:t.firstgid,tiles:t.tiles}}).filter(function(t){return t.tiles}).map(function(t){var e=0,i=t.tiles;for(var n in i){var r=i[n].objectgroup;r&&(a.set(t.firstgid+e,r),e++)}}),{map:n,layers:r,tileMap:a}},t.ctorParameters=function(){return[{type:n.c}]},t}()},212:function(t,e){function i(t){throw new Error("Cannot find module '"+t+"'.")}i.keys=function(){return[]},i.resolve=i,t.exports=i,i.id=212},213:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),r=i(299),a=i(189),s=i(284);r.a.production&&i.i(n.a)(),i.i(a.a)().bootstrapModuleFactory(s.a)},282:function(t,e,i){"use strict";i.d(e,"a",function(){return n});var n=[".game__canvas__background[_ngcontent-%COMP%]{position:relative}.game__canvas__sprites[_ngcontent-%COMP%]{position:absolute;top:0;left:0}.game__canvas__background[_ngcontent-%COMP%], .game__canvas__sprites[_ngcontent-%COMP%]{-webkit-transform:translateZ(0);transform:translateZ(0)}"]},283:function(t,e,i){"use strict";var n=i(285),r=i(165),a=i(28),s=i(99),o=i(195),h=i(40),u=i(36),c=i(59),p=i(70),l=i(39),m=i(282);i.d(e,"a",function(){return g});var d=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},_=function(){function t(t,e){this._changed=!1,this.context=new n.a(t,e)}return t.prototype.ngOnDetach=function(t,e,i){},t.prototype.ngOnDestroy=function(){},t.prototype.ngDoCheck=function(t,e,i){var n=this._changed;return this._changed=!1,n},t.prototype.checkHost=function(t,e,i,n){},t.prototype.handleEvent=function(t,e){var i=!0;return i},t.prototype.subscribe=function(t,e){this._eventHandler=e},t}(),y=a.createRenderComponentType("",0,s.b.None,[],{}),f=function(t){function e(i,n,r,a){t.call(this,e,y,h.a.HOST,i,n,r,a,u.b.CheckAlways)}return d(e,t),e.prototype.createInternal=function(t){return this._el_0=a.selectOrCreateRenderHostElement(this.renderer,"app-root",a.EMPTY_INLINE_ARRAY,t,null),this.compView_0=new A(this.viewUtils,this,0,this._el_0),this._GameService_0_3=new o.a(this.injectorGet(p.a,this.parentIndex)),this._AppComponent_0_4=new _(new l.a(this._el_0),this._GameService_0_3),this.compView_0.create(this._AppComponent_0_4.context),this.init(this._el_0,this.renderer.directRenderer?null:[this._el_0],null),new c.a(0,this,this._el_0,this._AppComponent_0_4.context)},e.prototype.injectorGetInternal=function(t,e,i){return t===o.a&&0===e?this._GameService_0_3:t===n.a&&0===e?this._AppComponent_0_4.context:i},e.prototype.detectChangesInternal=function(t){this._AppComponent_0_4.ngDoCheck(this,this._el_0,t),t||0===this.numberOfChecks&&this._AppComponent_0_4.context.ngAfterContentInit(),this.compView_0.internalDetectChanges(t)},e.prototype.destroyInternal=function(){this.compView_0.destroy()},e.prototype.visitRootNodesInternal=function(t,e){t(this._el_0,e)},e}(r.a),g=new c.b("app-root",f,n.a),v=[m.a],b=a.createRenderComponentType("",0,s.b.Emulated,v,{}),A=function(t){function e(i,n,r,a){t.call(this,e,b,h.a.COMPONENT,i,n,r,a,u.b.CheckAlways)}return d(e,t),e.prototype.createInternal=function(t){var e=this.renderer.createViewRoot(this.parentElement);return this._el_0=a.createRenderElement(this.renderer,e,"div",new a.InlineArray2(2,"style","position: relative"),null),this._text_1=this.renderer.createText(this._el_0,"\n    ",null),this._el_2=a.createRenderElement(this.renderer,this._el_0,"div",new a.InlineArray4(4,"class","game__canvas__sprites","id","game"),null),this._text_3=this.renderer.createText(this._el_0,"\n",null),this.init(null,this.renderer.directRenderer?null:[this._el_0,this._text_1,this._el_2,this._text_3],null),null},e}(r.a)},284:function(t,e,i){"use strict";var n=i(98),r=i(286),a=i(144),s=i(156),o=i(116),h=i(173),u=i(266),c=i(187),p=i(34),l=i(53),m=i(63),d=i(54),_=i(27),y=i(76),f=i(23),g=i(77),v=i(75),b=i(121),A=i(87),w=i(28),T=i(117),P=i(42),R=i(68),x=i(43),E=i(114),S=i(294),C=i(283),I=i(97),k=i(35),M=i(118),O=i(119),D=i(41),G=i(74),N=i(57),q=i(95),B=i(45),L=i(73),j=i(62),H=i(102),F=i(89),V=i(90),U=i(33),z=i(69),X=i(70);i.d(e,"a",function(){return J});var K=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Z=function(t){function e(e){t.call(this,e,[C.a],[C.a])}return K(e,t),Object.defineProperty(e.prototype,"_LOCALE_ID_7",{get:function(){return null==this.__LOCALE_ID_7&&(this.__LOCALE_ID_7=s.a(this.parent.get(I.a,null))),this.__LOCALE_ID_7},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_NgLocalization_8",{get:function(){return null==this.__NgLocalization_8&&(this.__NgLocalization_8=new p.a(this._LOCALE_ID_7)),this.__NgLocalization_8},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_ApplicationRef_13",{get:function(){return null==this.__ApplicationRef_13&&(this.__ApplicationRef_13=this._ApplicationRef__12),this.__ApplicationRef_13},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_Compiler_14",{get:function(){return null==this.__Compiler_14&&(this.__Compiler_14=new _.a),this.__Compiler_14},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_APP_ID_15",{get:function(){return null==this.__APP_ID_15&&(this.__APP_ID_15=k.a()),this.__APP_ID_15},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_DOCUMENT_16",{get:function(){return null==this.__DOCUMENT_16&&(this.__DOCUMENT_16=o.a()),this.__DOCUMENT_16},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_HAMMER_GESTURE_CONFIG_17",{get:function(){return null==this.__HAMMER_GESTURE_CONFIG_17&&(this.__HAMMER_GESTURE_CONFIG_17=new y.a),this.__HAMMER_GESTURE_CONFIG_17},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_EVENT_MANAGER_PLUGINS_18",{get:function(){return null==this.__EVENT_MANAGER_PLUGINS_18&&(this.__EVENT_MANAGER_PLUGINS_18=[new M.a,new O.a,new y.b(this._HAMMER_GESTURE_CONFIG_17)]),this.__EVENT_MANAGER_PLUGINS_18},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_EventManager_19",{get:function(){return null==this.__EventManager_19&&(this.__EventManager_19=new f.a(this._EVENT_MANAGER_PLUGINS_18,this.parent.get(D.a))),this.__EventManager_19},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_AnimationDriver_21",{get:function(){return null==this.__AnimationDriver_21&&(this.__AnimationDriver_21=o.b()),this.__AnimationDriver_21},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_DomRootRenderer_22",{get:function(){return null==this.__DomRootRenderer_22&&(this.__DomRootRenderer_22=new v.a(this._DOCUMENT_16,this._EventManager_19,this._DomSharedStylesHost_20,this._AnimationDriver_21,this._APP_ID_15)),this.__DomRootRenderer_22},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_RootRenderer_23",{get:function(){return null==this.__RootRenderer_23&&(this.__RootRenderer_23=G.a(this._DomRootRenderer_22,this.parent.get(G.b,null),this.parent.get(d.a,null))),this.__RootRenderer_23},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_DomSanitizer_24",{get:function(){return null==this.__DomSanitizer_24&&(this.__DomSanitizer_24=new b.a),this.__DomSanitizer_24},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_Sanitizer_25",{get:function(){return null==this.__Sanitizer_25&&(this.__Sanitizer_25=this._DomSanitizer_24),this.__Sanitizer_25},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_AnimationQueue_26",{get:function(){return null==this.__AnimationQueue_26&&(this.__AnimationQueue_26=new A.a(this.parent.get(D.a))),this.__AnimationQueue_26},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_ViewUtils_27",{get:function(){return null==this.__ViewUtils_27&&(this.__ViewUtils_27=new w.ViewUtils(this._RootRenderer_23,this._Sanitizer_25,this._AnimationQueue_26)),this.__ViewUtils_27},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_IterableDiffers_28",{get:function(){return null==this.__IterableDiffers_28&&(this.__IterableDiffers_28=s.b()),this.__IterableDiffers_28},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_KeyValueDiffers_29",{get:function(){return null==this.__KeyValueDiffers_29&&(this.__KeyValueDiffers_29=s.c()),this.__KeyValueDiffers_29},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_SharedStylesHost_30",{get:function(){return null==this.__SharedStylesHost_30&&(this.__SharedStylesHost_30=this._DomSharedStylesHost_20),this.__SharedStylesHost_30},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_Title_31",{get:function(){return null==this.__Title_31&&(this.__Title_31=new T.a),this.__Title_31},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_RadioControlRegistry_32",{get:function(){return null==this.__RadioControlRegistry_32&&(this.__RadioControlRegistry_32=new P.a),this.__RadioControlRegistry_32},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_BrowserXhr_33",{get:function(){return null==this.__BrowserXhr_33&&(this.__BrowserXhr_33=new R.a),this.__BrowserXhr_33},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_ResponseOptions_34",{get:function(){return null==this.__ResponseOptions_34&&(this.__ResponseOptions_34=new x.a),this.__ResponseOptions_34},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_XSRFStrategy_35",{get:function(){return null==this.__XSRFStrategy_35&&(this.__XSRFStrategy_35=c.a()),this.__XSRFStrategy_35},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_XHRBackend_36",{get:function(){return null==this.__XHRBackend_36&&(this.__XHRBackend_36=new E.a(this._BrowserXhr_33,this._ResponseOptions_34,this._XSRFStrategy_35)),this.__XHRBackend_36},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_RequestOptions_37",{get:function(){return null==this.__RequestOptions_37&&(this.__RequestOptions_37=new S.a),this.__RequestOptions_37},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_Http_38",{get:function(){return null==this.__Http_38&&(this.__Http_38=c.b(this._XHRBackend_36,this._RequestOptions_37)),this.__Http_38},enumerable:!0,configurable:!0}),e.prototype.createInternal=function(){return this._CommonModule_0=new a.a,this._ApplicationModule_1=new s.d,this._BrowserModule_2=new o.c(this.parent.get(o.c,null)),this._InternalFormsSharedModule_3=new h.a,this._FormsModule_4=new u.a,this._HttpModule_5=new c.c,this._AppModule_6=new r.a,this._ErrorHandler_9=o.d(),this._ApplicationInitStatus_10=new l.a(this.parent.get(l.b,null)),this._Testability_11=new m.a(this.parent.get(D.a)),this._ApplicationRef__12=new d.b(this.parent.get(D.a),this.parent.get(N.a),this,this._ErrorHandler_9,this,this._ApplicationInitStatus_10,this.parent.get(m.b,null),this._Testability_11),this._DomSharedStylesHost_20=new g.a(this._DOCUMENT_16),this._AppModule_6},e.prototype.getInternal=function(t,e){return t===a.a?this._CommonModule_0:t===s.d?this._ApplicationModule_1:t===o.c?this._BrowserModule_2:t===h.a?this._InternalFormsSharedModule_3:t===u.a?this._FormsModule_4:t===c.c?this._HttpModule_5:t===r.a?this._AppModule_6:t===I.a?this._LOCALE_ID_7:t===p.b?this._NgLocalization_8:t===q.a?this._ErrorHandler_9:t===l.a?this._ApplicationInitStatus_10:t===m.a?this._Testability_11:t===d.b?this._ApplicationRef__12:t===d.c?this._ApplicationRef_13:t===_.a?this._Compiler_14:t===k.b?this._APP_ID_15:t===B.a?this._DOCUMENT_16:t===y.c?this._HAMMER_GESTURE_CONFIG_17:t===f.b?this._EVENT_MANAGER_PLUGINS_18:t===f.a?this._EventManager_19:t===g.a?this._DomSharedStylesHost_20:t===L.a?this._AnimationDriver_21:t===v.b?this._DomRootRenderer_22:t===j.a?this._RootRenderer_23:t===b.b?this._DomSanitizer_24:t===H.a?this._Sanitizer_25:t===A.a?this._AnimationQueue_26:t===w.ViewUtils?this._ViewUtils_27:t===F.a?this._IterableDiffers_28:t===V.a?this._KeyValueDiffers_29:t===g.b?this._SharedStylesHost_30:t===T.a?this._Title_31:t===P.a?this._RadioControlRegistry_32:t===R.a?this._BrowserXhr_33:t===x.b?this._ResponseOptions_34:t===U.a?this._XSRFStrategy_35:t===E.a?this._XHRBackend_36:t===z.a?this._RequestOptions_37:t===X.a?this._Http_38:e},e.prototype.destroyInternal=function(){this._ApplicationRef__12.ngOnDestroy(),this._DomSharedStylesHost_20.ngOnDestroy()},e}(n.a),J=new n.b(Z,r.a)},285:function(t,e,i){"use strict";var n=i(0),r=i(195),a=i(288);i.d(e,"a",function(){return s});var s=function(){function t(t,e){this.elementRef=t,this.gameService=e}return t.prototype.ngAfterContentInit=function(){this.game=new a.a(this.gameService)},t.prototype.refresh=function(){this.map.draw()},t.prototype.getBackgroundCanvas=function(){var t=this.elementRef.nativeElement.querySelector(".game__canvas__background");return t.width=1280,t.height=720,t},t.prototype.getSpritesCanvas=function(){var t=this.elementRef.nativeElement.querySelector(".game__canvas__sprites");return t.width=1280,t.height=720,t},t.prototype.getMapCtx=function(t){var e=t.getContext("2d");return e.webkitImageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e},t.ctorParameters=function(){return[{type:n.H},{type:r.a}]},t}()},286:function(t,e,i){"use strict";i.d(e,"a",function(){return n});var n=function(){function t(){}return t}()},287:function(t,e,i){"use strict";i.d(e,"a",function(){return n});var n;!function(t){t[t.human=0]="human",t[t.zombie=1]="zombie"}(n||(n={}))},288:function(t,e,i){"use strict";var n=i(290),r=i(293),a=i(289),s=i(296);i.d(e,"a",function(){return o});var o=function(){function t(t){var e=this;this.zombieTeamId=0,this.playerTeamId=1,this.ennemyTeamId=2,this.map=new a.a("zombie"),this.engine=new s.a(this.map.getName(),t),this.engine.observable.subscribe(function(t){return e.setUpTeams()},function(t){return console.error("error loading map")},function(){return console.log("c'est fini")})}return t.prototype.setUpTeams=function(){var t=this,e=this.engine,i=this.map;this.turn=0,this.map.setEngine(e),i.preparePathCalculator(),this.playerTeam=new Array,this.ennemyTeam=new Array,this.zombieTeam=new Array,this.addPlayer(5,3),this.addPlayer(6,3),this.addZombieAt(5,7),this.addZombieAt(4,8),this.addZombieAt(6,8),this.addZombieAt(5,8),this.addZombieAt(28,17),this.addZombieAt(29,17),this.addZombieAt(30,17),this.addZombieAt(31,17),this.addZombieAt(36,12),this.addZombieAt(36,10),this.addZombieAt(37,10),this.addZombieAt(38,10),this.addZombieAt(21,21),this.currentIndex=-1,this.currentTeamId=this.playerTeamId,this.currentTeam=this.playerTeam,this.updateAllVisibilities(),this.nextCharacter(),this.showAccessibleTilesByPlayer(),e.bindClick(function(e){return t.clickOn(e)}),e.bindOver(function(e){return t.overOn(e)},function(e){return t.overOff(e)})},t.prototype.addZombieAt=function(t,e){var i=r.a.popZombie(this.engine,this.map.getPointAtSquare(t,e),this.zombieTeamId,this.zombieTeam);return this.map.putEntityAtPoint(i),i},t.prototype.addPlayer=function(t,e){var i=n.a.popPlayer(this.engine,this.map.getPointAtSquare(t,e),this.playerTeamId,this.playerTeam,this.map);return this.map.putEntityAtPoint(i),i},t.prototype.nextAction=function(){this.currentEntity.currentAction++,this.currentEntity.currentAction>=this.currentEntity.maxAction&&this.nextCharacter(),console.time(this.currentTeamId+"/"+this.currentEntity.id+" nextAction"),this.updateVisibleSquaresOfEntity(this.currentEntity),this.prepareAction()},t.prototype.nextCharacter=function(){return this.currentIndex>=this.currentTeam.length-1?void this.nextTeam():(this.currentIndex=this.currentIndex+1,this.currentEntity=this.currentTeam[this.currentIndex],this.currentEntity.currentAction=0,void this.engine.setGlowPosition(this.currentEntity.position))},t.prototype.nextTeam=function(){this.currentIndex=-1,this.currentTeamId===this.playerTeamId?(this.currentTeamId=this.zombieTeamId,this.currentTeam=this.zombieTeam):this.currentTeamId===this.zombieTeamId&&(this.currentTeamId=this.playerTeamId,this.currentTeam=this.playerTeam),this.nextCharacter()},t.prototype.targeted=function(t){return this.currentEntity.id===t.id?void console.log("it's me"):void(this.IsEntityInCurrentTeam(t)?this.helpTeamMate(t):this.currentEntity.attack(t))},t.prototype.updateVisibleSquaresOfEntity=function(t){console.time("updateVisibleSquaresOfEntity"),this.map.setVisibileSquares(t),console.timeEnd("updateVisibleSquaresOfEntity")},t.prototype.updateAllVisibilities=function(){var t=this;this.playerTeam.forEach(function(e){t.map.setVisibileSquares(e,!0)}),this.zombieTeam.forEach(function(e){t.map.setVisibileSquares(e,!0)})},t.prototype.IsEntityInCurrentTeam=function(t){return t.teamId===this.currentTeamId},t.prototype.helpTeamMate=function(t){console.log(this.currentEntity+" helps "+t)},t.prototype.overOff=function(t){var e=this;if(this.currentTeamId===this.playerTeamId&&!this.ticking){if(this.entityFocused){var i=this.entityFocused.visibleSquares.map(function(t){return e.map.getPointAtSquare(t.x,t.y)}).map(function(t){return t.x+":"+t.y});this.engine.removeVisibleTiles(i)}this.entityFocused=null}},t.prototype.overOn=function(t){var e=this;if(this.currentTeamId===this.playerTeamId&&!this.ticking){var i=this.map.getSquareAtPoint(t);if(console.log("over",i),i.entity){this.entityFocused=i.entity;var n=i.entity.visibleSquares.map(function(t){return e.map.getPointAtSquare(t.x,t.y)});console.time("addVisibleTiles"),this.engine.addVisibleTiles([],n),console.timeEnd("addVisibleTiles")}}},t.prototype.clickOn=function(t){var e=this;if(this.currentTeamId===this.playerTeamId&&!this.ticking){var i=this.map.getSquareAtPoint(t);if(i.entity)this.currentEntity.updateAccessibleTiles=!1,this.targeted(i.entity),this.ticking=!0,this.nextAction(),this.ticking=!1;else{if(!this.map.canEntityGoToTarget(this.currentEntity,t))return;this.map.moveEntityAtPoint(this.currentEntity,t,function(){e.currentEntity.updateAccessibleTiles=!0,e.currentEntity.targetSquare=e.map.getSquareAtPoint(t),e.showAccessibleTilesByPlayer(),e.nextAction(),e.ticking=!1},function(t){console.log("sorry",t),e.ticking=!1}),this.ticking=!0}}},t.prototype.prepareAction=function(){var t=this;this.currentTeamId===this.zombieTeamId?(console.time(this.currentTeamId+"/"+this.currentEntity.id+" zombie play"),this.zombieTeam[this.currentIndex].play(this.map,function(){console.timeEnd(t.currentTeamId+"/"+t.currentEntity.id+" zombie play"),console.timeEnd(t.currentTeamId+"/"+t.currentEntity.id+" nextAction"),console.time(t.currentTeamId+"/"+t.currentEntity.id+" timeout"),setTimeout(function(){console.timeEnd(t.currentTeamId+"/"+t.currentEntity.id+" timeout"),t.nextAction()},300)})):0===this.currentEntity.currentAction&&(this.showAccessibleTilesByPlayer(),console.timeEnd(this.currentTeamId+"/"+this.currentEntity.id+" nextAction"))},t.prototype.showAccessibleTilesByPlayer=function(){this.currentEntity.updateAccessibleTiles=!0,this.map.setAccessibleTilesByEntity(this.currentEntity),this.currentEntity.updateAccessibleTiles=!1,this.showAccessibleTiles(this.currentEntity)},t.prototype.showAccessibleTiles=function(t){var e=this,i=new Array;t.pathMap.forEach(function(t,n){var r=n.split(":"),a=Number(r[0]),s=Number(r[1]);i.push(e.map.getPointAtSquare(a,s))}),this.engine.addAccessibleTiles(i)},t}()},289:function(t,e,i){"use strict";var n=i(139);i.n(n);i.d(e,"a",function(){return r});var r=function(){function t(t){this.name=t,this.entities=new Array,this.squares=new Map,this.mapLastUpdate=(new Date).getTime()}return t.prototype.setEngine=function(t){this.engine=t,this.rnd=t.phaserGame.rnd},t.prototype.setVisibileSquares=function(t,e){var i=this;if(t.updateAccessibleTiles||e){console.time(t.id+"=>setVisibileSquares");var n=t.square,r=n.x,a=n.y,s=this.getSquareInRange(r,a,t.visionRange),o=new Array;s.forEach(function(e){var r=i.BresenhamLine(n,e),a=r.length>2?r[1]:null;if(!(a&&t.coverDetection<a.cover)){var s=r.reduce(function(t,e){return 100!==e.cover&&t},!0);s&&o.push(e)}}),t.visibleSquares=o,console.timeEnd(t.id+"=>setVisibileSquares")}},t.prototype.getSquareInRange=function(t,e,i){function n(e,i){function n(){var t=r+":"+i,e=u.get(t);e&&r>=0&&i>=0&&(e.data.distanceFrom=r,o.set(t,u.get(t)))}var r=e;if(e<t)for(r;r<=t;r++)n();else for(r;r>=t;r--)n()}var r=-i,a=0,s=2-2*i,o=(new Array,new Map),h=new Array,u=(this.size,this.isBetween,this.squares);do n(t-r,e+a),n(t-a,e-r),n(t+r,e-a),n(t+a,e+r),i=s,i<=a&&(s+=2*++a+1),(i>r||s>a)&&(s+=2*++r+1);while(r<0);return o.forEach(function(t){return h.push(t)}),h},t.prototype.getVisibleEntitiedByEntity=function(t){var e=this,i=t.square,n=i.x,r=i.y,a=Math.max(n-t.visionRange,0),s=Math.min(n+t.visionRange,this.size.width),o=Math.max(r-t.visionRange,0),h=Math.min(r+t.visionRange,this.size.height),u=function(t){return e.isBetween(t.square.x,a,s)&&e.isBetween(t.square.y,o,h)},c=this.entities.filter(u).filter(function(i){return e.isEntityCanSeeEntityB(t,i)});return c},t.prototype.isBetween=function(t,e,i){return e<=t&&t<=i},t.prototype.isEntityCanSeeEntityB=function(t,e){var i=this.BresenhamLine(t.square,e.square);return i.reduce(function(e,i){return!(t.coverDetection<i.cover)&&e},!0)},t.prototype.BresenhamLine=function(t,e){var i=t.x,n=t.y,r=e.x,a=e.y,s=new Array,o=Math.abs(a-n)>Math.abs(r-i);if(o&&(i=t.y,n=t.x,r=e.y,a=e.x),i>r){var h=i;i=r,r=h;var u=n;n=a,a=u}for(var c=r-i,p=Math.abs(a-n),l=0,m=n<a?1:-1,d=n,_=i;_<=r;_++){var y=new Phaser.Point;o?(y.x=d,y.y=_):(y.x=_,y.y=d);var f=y.x+":"+y.y;s.push(this.squares.get(f)),l+=p,2*l>=c&&(d+=m,l-=c)}return s},t.prototype.preparePathCalculator=function(){var t=this,e=this.engine.map;this.size={width:e.width/2,height:e.height/2},this.grid=new Array,n.times(this.size.height,function(e){var i=new Array;n.times(t.size.width,function(n){var r=t.getPointAtSquare(n,e),a=t.engine.isPositionCollidable(r)?1:0,s=t.engine.getPositionCover(r),o=t.engine.getPositionMask(r);i.push(a);var h=n+":"+e;t.squares.has(h)||t.squares.set(h,{entity:null,x:n,y:e,cover:s,data:{},mask:o})}),t.grid.push(i)})},t.prototype.putEntityAtPoint=function(t){var e=new Phaser.Point;e.x=t.position.x,e.y=t.position.y;var i=this.getSquareAtPoint(e);if(i.entity)throw new Error("entity.already.here");return this.grid[i.y][i.x]+=10,i.entity=t,t.square=i,t.targetSquare=i,i.mask?t.maskEntity():t.unmaskEntity(),this.entities.push(t),i},t.prototype.setAccessibleTilesByEntity=function(t){t.mapLastUpdate=this.mapLastUpdate;var e=this.getSquareInRange(t.targetSquare.x,t.targetSquare.y,t.mouvementRange),i=this.getWalkableTiles(t.targetSquare,e,t.mouvementRange);this.collecteAccessibleTiles(t,i)},t.prototype.collecteAccessibleTiles=function(t,e){t.pathMap=e},t.prototype.moveEntityFollowingPath=function(t,e,i,r){function a(){var e=u[c],n=s.getPointAtSquare(e.x,e.y),r=s.getSquareAtPoint(n);t.square=r,c>=u.length-1?(t.move(n,function(){var e=s.getSquareAtPoint(n);t.finishMoving(),h.entity=null,e.entity=t;var r=o[h.y][h.x];0===r||1===r?o[h.y][h.x]=0:r>9&&(o[h.y][h.x]-=10),o[e.y][e.x]+=10,i()}),s.engine.moveGlowPosition(n),s.mapLastUpdate=(new Date).getTime()):(c+=1,console.log("moving to ",n.x+":"+n.y,e),t.move(n,function(){return a()}),s.engine.moveGlowPosition(n))}var s=this,o=this.grid,h=this.getSquareAtPoint(t.position),u=this.getPathTo(h,n.last(e),t.mouvementRange,!0);if(null===u)return void r("Path was not found.");var c=0;a()},t.prototype.canEntityGoToTarget=function(t,e){var i=this.getSquareAtPoint(e),n=this.getCoordinatesKey(i.x,i.y);return null!=t.pathMap.get(n)},t.prototype.moveEntityAtPoint=function(t,e,i,n){var r=this,a=this.getSquareAtPoint(t.position),s=this.getSquareAtPoint(e),o=this.grid,h=this.getPathTo(a,s,t.mouvementRange,!0);if(!h)return void n("Path was not found.");var u=0,c=function(){var e=h[u],n=r.getPointAtSquare(e.x,e.y),p=r.getSquareAtPoint(n);t.square=p,u>=h.length-1?(t.move(n,function(){t.finishMoving(),a.entity=null,s.entity=t;var e=o[a.y][a.x];0===e||1===e?o[a.y][a.x]=0:e>9&&(o[a.y][a.x]-=10),o[s.y][s.x]+=10,i()}),r.engine.moveGlowPosition(n)):(u+=1,console.log("moving to ",n.x+":"+n.y,e),t.move(n,function(){return c()}),r.engine.moveGlowPosition(n))};c()},t.prototype.getName=function(){return this.name},t.prototype.getSize=function(){return this.size},t.prototype.getPointAtSquare=function(t,e){var i=new Phaser.Point;return i.x=Math.min(32*t,32*this.size.width),i.y=Math.min(32*e,32*this.size.width),i},t.prototype.getSquare=function(t,e){var i=this.getCoordinatesKey(t,e);return this.squares.get(i)},t.prototype.getSquareAtPoint=function(t){var e=this.getPointKey(t),i=Math.min(t.x/32,this.size.width),n=Math.min(t.y/32,this.size.width);return this.squares.has(e)||this.squares.set(e,{entity:null,x:i,y:n,cover:0,data:{},mask:!1}),this.squares.get(e)},t.prototype.getPointKey=function(t){var e=Math.min(t.x/32,this.size.width),i=Math.min(t.y/32,this.size.width);return this.getCoordinatesKey(e,i)},t.prototype.getCoordinatesKey=function(t,e){return t+":"+e},t.prototype.getPathTo=function(t,e,i,r){var a=this.buildNewGraph(e,r),s=a.grid[t.x][t.y],o=a.grid[e.x][e.y],h=(new Map,astar.search(a,s,o)),u=h.length,c=n.dropRight(h.map(function(t){return{x:t.x,y:t.y}}),u-1-i);return c},t.prototype.getWalkableTiles=function(t,e,i){var r=this;console.time("getWalkableTiles");var a,s,o=999,h=-1,u=(this.grid,new Map),c=new Map,p=this.buildNewGraph();a=e.sort(function(t,e){return t.data.distanceFrom-e.data.distanceFrom}).reverse().reduce(function(t,e){return e.data.distanceFrom!=o&&(o=e.data.distanceFrom,h++,t.push([])),e.data.process=!0,t[h].push(e),t},new Array),s=0;var l=p.grid[t.x][t.y];return console.time("astar.search"),a.forEach(function(t){t.forEach(function(t){var e=p.grid[t.x][t.y],a=r.getCoordinatesKey(t.x,t.y);if(!c.has(a)){var s=astar.search(p,l,e);if(n.isEmpty(s)||s.length>i)return void c.set(a,null);var o=s.map(function(t){return{x:t.x,y:t.y}}),h=o.length;o.forEach(function(t,e){var i=n.dropRight(o,h-1-e);c.set(r.getCoordinatesKey(t.x,t.y),i)})}})}),console.timeEnd("astar.search"),c.forEach(function(t,e){t&&u.set(e,t)}),console.timeEnd("getWalkableTiles"),u},t.prototype.buildNewGraph=function(t,e){var i=n.range(50).map(function(t){return n.range(50).map(function(t){return-1})});return this.grid.map(function(t,e){t.forEach(function(t,n){return i[n][e]=t>0?0:1})}),t&&(i[t.x][t.y]=1),new Graph(i,{diagonal:e})},t}()},290:function(t,e,i){"use strict";var n=i(194),r=i(292);i.d(e,"a",function(){return s});var a=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},s=function(t){function e(e,i,n){t.call(this,e,i),this.sprite=e.createHuman(i),this.teamId=n,this.maxAction=2,this.mouvementRange=10,this.visionRange=4,this.coverDetection=10,this.updateAccessibleTiles=!0}return a(e,t),e.prototype.move=function(e,i){return t.prototype.move.call(this,e,i),this},e.popPlayer=function(t,i,n,a,s){var o=new e(t,i,n);return a.push(o),o.weapons.push(r.a.add(r.b.SHOOTGUN,s)),o},e.prototype.attack=function(e){return t.prototype.attack.call(this,e),this.engine.playSound("gun"),this.engine.shake(),this.weapons[0].fire(this,e),console.log("zombie attacks "+e.id+e.teamId),this},e}(n.a)},291:function(t,e,i){"use strict";var n=i(298);i.d(e,"a",function(){return a});var r=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},a=function(t){function e(e){t.call(this,e,null,null,"markers"),this.animations.add("visible",["marker/visible_tile"],5,!0),this.play("visible")}return r(e,t),e.prototype.spawn=function(e,i,n){t.prototype.spawn.call(this,e,i,n)},e}(n.a)},292:function(t,e,i){"use strict";var n=i(139);i.n(n);i.d(e,"b",function(){return r}),i.d(e,"a",function(){return s});var r;!function(t){t[t.NINEMM=0]="NINEMM",t[t.SHOOTGUN=1]="SHOOTGUN",t[t.AR15=2]="AR15",t[t.RUGER_K1=3]="RUGER_K1",t[t.BLASER_R8=4]="BLASER_R8",t[t.PIPE=5]="PIPE",t[t.AXE=6]="AXE",t[t.PUNCH=7]="PUNCH",t[t.BAT=8]="BAT",t[t.NAILBAT=9]="NAILBAT",t[t.KNIFE=10]="KNIFE",t[t.KATANA=11]="KATANA",t[t.HAND_GRENADE=12]="HAND_GRENADE"}(r||(r={}));var a=function(){function t(t,e){this.data=t,this.map=e,this.isJammed=!1,this.rnd=e.rnd}return t.prototype.fire=function(t,e){if(!this.isJammed){if(this.data.isRanged){if(!(this.data.currentAmmo>0))return;this.data.currentAmmo--}this.checkJam()||(0==this.data.spreadAngle?this.shootSingleBullet(t,e):this.shootMultyBullet(t,e))}},t.prototype.shootSingleBullet=function(t,e){var i=1;if(this.checkHitSuccess()){this.checkCriticalSuccess()&&(i=2);var n=i*this.getDamage();e.touched(t,n)}},t.prototype.shootMultyBullet=function(t,e){var i=this,r=t.square,a=-Math.atan2(e.square.y-r.y,e.square.x-r.x)*(180/Math.PI),s=a+this.data.spreadAngle/2,o=this.data.spreadAngle/this.data.projectileByShot;n.times(this.data.projectileByShot,function(e){i.processSingleBullet(t,r,s-e*o)})},t.prototype.toRadians=function(e){return e*t.RADIANS_FACTOR},t.prototype.processSingleBullet=function(t,e,i){var r=this,a=Math.round(Math.cos(this.toRadians(i))*this.data.maxRange)+e.x,s=-Math.round(Math.sin(this.toRadians(i))*this.data.maxRange)+e.y,o=this.map.getSquare(a,s),h=this.map.BresenhamLine(e,o),u=n(h).tail().filter(function(t){return t.entity}).map(function(t){return t.entity}).value(),c=0;console.log("bullet",i,a,s),u.forEach(function(e){var i=1;if(!(c>=r.data.maxEntityByBullet)&&r.checkHitSuccess()){c++,r.checkCriticalSuccess()&&(i=2);var n=i*r.getDamage();e.touched(t,n)}})},t.prototype.reload=function(){this.data.currentAmmo=this.data.maxAmmo},t.prototype.checkJam=function(){return this.checkRollSuccess(this.data.jammedChance)&&(this.isJammed=!0),this.isJammed},t.prototype.getDamage=function(){return this.rnd.integerInRange(this.data.minDamage,this.data.maxDamage)},t.prototype.checkCriticalSuccess=function(){return this.checkRollSuccess(this.data.criticalChance);
},t.prototype.checkHitSuccess=function(){return this.checkRollSuccess(this.data.precision)},t.prototype.checkRollSuccess=function(t){var e=this.rnd.realInRange(0,100);return e<=t},t.RADIANS_FACTOR=Math.PI/180,t}(),s=function(){function t(){}return t.add=function(t,e){switch(t){case r.NINEMM:return new a({minRange:0,maxRange:9,minDamage:1,maxDamage:3,precision:65,criticalChance:10,jammedChance:5,maxEntityByBullet:1,maxAmmo:6,currentAmmo:6,spreadAngle:0,damageRange:0,projectileByShot:1,isRanged:!1},e);case r.SHOOTGUN:return new a({minRange:0,maxRange:5,minDamage:1,maxDamage:2,precision:80,criticalChance:10,jammedChance:5,maxEntityByBullet:1,maxAmmo:4,currentAmmo:4,spreadAngle:30,damageRange:0,projectileByShot:6,isRanged:!1},e);case r.PIPE:return new a({minRange:0,maxRange:0,minDamage:0,maxDamage:0,precision:0,criticalChance:10,jammedChance:5,maxEntityByBullet:1,maxAmmo:6,currentAmmo:6,spreadAngle:0,damageRange:0,projectileByShot:1,isRanged:!1},e);case r.AXE:return new a({minRange:0,maxRange:0,minDamage:0,maxDamage:0,precision:0,criticalChance:10,jammedChance:5,maxEntityByBullet:1,maxAmmo:6,currentAmmo:6,spreadAngle:0,damageRange:0,projectileByShot:1,isRanged:!1},e);case r.PUNCH:return new a({minRange:0,maxRange:0,minDamage:0,maxDamage:0,precision:0,criticalChance:10,jammedChance:5,maxEntityByBullet:1,maxAmmo:6,currentAmmo:6,spreadAngle:0,damageRange:0,projectileByShot:1,isRanged:!1},e);case r.BAT:return new a({minRange:0,maxRange:0,minDamage:0,maxDamage:0,precision:0,criticalChance:10,jammedChance:5,maxEntityByBullet:1,maxAmmo:6,currentAmmo:6,spreadAngle:0,damageRange:0,projectileByShot:1,isRanged:!1},e);case r.NAILBAT:return new a({minRange:0,maxRange:0,minDamage:0,maxDamage:0,precision:0,criticalChance:10,jammedChance:5,maxEntityByBullet:1,maxAmmo:6,currentAmmo:6,spreadAngle:0,damageRange:0,projectileByShot:1,isRanged:!1},e);case r.KNIFE:return new a({minRange:0,maxRange:0,minDamage:0,maxDamage:0,precision:0,criticalChance:10,jammedChance:5,maxEntityByBullet:1,maxAmmo:6,currentAmmo:6,spreadAngle:0,damageRange:0,projectileByShot:1,isRanged:!1},e);case r.KATANA:return new a({minRange:0,maxRange:0,minDamage:0,maxDamage:0,precision:0,criticalChance:10,jammedChance:5,maxEntityByBullet:1,maxAmmo:6,currentAmmo:6,spreadAngle:0,damageRange:0,projectileByShot:1,isRanged:!1},e)}},t}()},293:function(t,e,i){"use strict";var n=i(194),r=i(139);i.n(r);i.d(e,"a",function(){return h});var a,s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)};!function(t){t[t.ALERT=0]="ALERT",t[t.IDDLE=1]="IDDLE",t[t.SEARCHING=2]="SEARCHING"}(a||(a={}));var o=["01","02","03","04","05","06","07","08"],h=function(t){function e(e,i,n,s){t.call(this,e,i),this.sprite=e.createZombie(i,o[r.random(0,o.length-1)]),this.teamId=n,this.team=s,this.maxAction=2,this.mouvementRange=6,this.pv=6,this.currentStatus=a.IDDLE,this.visionRange=12,this.coverDetection=10,this.updateAccessibleTiles=!0}return s(e,t),e.popZombie=function(t,i,n,r){var a=new e(t,i,n,r);return r.push(a),a},e.prototype.play=function(t,e){var i=this.visibleSquares.filter(function(t){return t.entity}).map(function(t){return t.entity});this.lookForHumaaaans(i,t,e)?console.log("fresh meat ..."):this.goForCloserZombie(i,t,e)},e.prototype.pathToClosestEntity=function(t,e){var i,n=null,a=999,s=this.mouvementRange,o=null,h=this.square;this.pathMap;return t.forEach(function(t){function u(t,i){if(h.x===t&&h.y===i)return void c([],h);var n=e.getSquare(t,i),o=e.getPathTo(h,n,s),u=r.last(o),p=u?e.getSquare(u.x,u.y):null;return o&&o.length>0&&o.length<a&&p===n?void c(o,p):void 0}function c(e,r){n=t,a=e.length,o=e,i=r}var p=t.square;if(u(p.x-1,p.y-1),u(p.x,p.y-1),u(p.x+1,p.y-1),u(p.x-1,p.y),u(p.x+1,p.y),u(p.x-1,p.y+1),u(p.x,p.y+1),u(p.x+1,p.y+1),!o){var l=e.getPathTo(h,p,s),m=r.last(l),d=m?e.getSquare(m.x,m.y):null;if(console.log("path to humaaaans",o),l)return void c(l,d)}}),{distance:a,entity:n,path:o,target:i}},e.prototype.goForCloserZombie=function(t,e,i){var n=this,r=t.filter(function(t){return t.teamId===n.teamId&&t.id!=n.id}),a=this.pathToClosestEntity(r,e);return a.entity?(0===a.distance?(this.updateAccessibleTiles=!1,i()):(this.targetSquare=a.target,this.updateAccessibleTiles=!0,e.moveEntityFollowingPath(this,a.path,function(){return i()},function(){return console.error("oh ...")})),!1):(i(),!1)},e.prototype.lookForHumaaaans=function(t,e,i){var n=this,r=t.filter(function(t){return t.teamId!==n.teamId}),a=this.pathToClosestEntity(r,e);return!!a.entity&&(0===a.distance?(this.attack(a.entity),this.updateAccessibleTiles=!1,i()):(this.targetSquare=a.target,this.updateAccessibleTiles=!0,e.moveEntityFollowingPath(this,a.path,function(){return i()},function(){return console.error("oh ...")})),!0)},e.prototype.attack=function(e){return t.prototype.attack.call(this,e),this.engine.playSound("grunt"),this.engine.shake(),console.log("zombie attacks "+e.id+e.teamId),this},e.prototype.touched=function(t,e){if(console.log("aaaargh",t,"hit me for",e),this.engine.playSound("grunt"),this.pv=this.pv-e,this.pv<=0){console.log("aaaargh, i am really dead"),this.sprite.alive=!1,this.sprite.visible=!1,this.sprite.animations.stop(),this.square.entity=null;r(this.team).remove(["id",this.id]).value()}return this},e}(n.a)},294:function(t,e,i){"use strict";var n=i(183);i.d(e,"a",function(){return a});var r=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},a=function(t){function e(){t.call(this),this.headers.set("Content-Type","application/json")}return r(e,t),e.ctorParameters=function(){return[]},e}(n.a);({provide:n.b,useClass:a})},295:function(t,e,i){"use strict";var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=function(t){function e(){t.apply(this,arguments)}return n(e,t),e.addToAnimations=function(t,i,n,r,a,s,o){r=r||[],a=a||60,void 0===s&&(s=!1),void 0===o&&(o=!(!r||"number"!=typeof r[0])),t._outputFrames=[],t._frameData.getFrameIndexes(r,o,t._outputFrames);var h=new e(t.game,t.sprite,n,t._frameData,t._outputFrames,a,s);return h.timelineDelay=i,t._anims[n]=h,t.currentAnim=t._anims[n],t.sprite.tilingTexture&&(t.sprite.refreshTexture=!0),t._anims[n]},e.prototype.update=function(){return!this.isPaused&&(!!(this.isPlaying&&this.game.time.time>=this._timeNextFrame)&&(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame+this.timelineDelay,this._timeLastFrame=this.game.time.time,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay),this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this.isReversed?this._frameIndex-=this._frameSkip:this._frameIndex+=this._frameSkip,!this.isReversed&&this._frameIndex>=this._frames.length||this.isReversed&&this._frameIndex<=-1?this.loop?(this._frameIndex=Math.abs(this._frameIndex)%this._frames.length,this.isReversed&&(this._frameIndex=this._frames.length-1-this._frameIndex),this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&this._parent.setFrame(this.currentFrame),this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this),!this.onUpdate||(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData)):(this.complete(),!1):this.updateCurrentFrame(!0)))},e}(Phaser.Animation);e.a=r},296:function(t,e,i){"use strict";var n=i(21),r=(i.n(n),i(297)),a=i(291),s=i(295);i.d(e,"a",function(){return o});var o=function(){function t(t,e){var i=this;this.gameService=e,this.horizontalScroll=!0,this.verticalScroll=!0,this.kineticMovement=!0,this.speed=300,this.debug=!0,this.mapVisibleTileCount=new Map,this.mapVisibleTile=new Map,this.overTimer={key:"",time:-1,tick:!1,wasOver:!1},this.observable=n.Observable.create(function(t){i.o=t,i.status=t.next}),this.gameService.getMapJson(t).subscribe(function(t){return i.init(t)},function(t){return console.error("error loading map")},function(){return console.log("c'est fini")})}return t.prototype.init=function(t){function e(){r.preload(t)}function i(){r.create(t)}function n(){r.update()}var r=this;this.phaserGame=new Phaser.Game(1600*window.devicePixelRatio,(window.innerHeight-100)*window.devicePixelRatio,Phaser.WEBGL,"game",{preload:e,create:i,update:n},!1,!1)},t.prototype.bindClick=function(t){this.click=t},t.prototype.bindOver=function(t,e){this.over=t,this.overOff=e},t.prototype.shake=function(){this.phaserGame.camera.resetFX(),this.phaserGame.camera.shake(.004,100,!0,Phaser.Camera.SHAKE_BOTH,!0)},t.prototype.preload=function(t){Phaser.Canvas.setImageRenderingCrisp(this.phaserGame.canvas),this.phaserGame.load.atlas("sprites","assets/sprites/spriteatlas/sprites.png","assets/sprites/spriteatlas/sprites.json",Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY),this.phaserGame.load.atlas("heroes-sprites","assets/tiles/POPHorrorCity_GFX/Graphics/Characters/Male_Heroes.png","assets/tiles/POPHorrorCity_GFX/Graphics/Characters/Male_Heroes.json",Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY),this.phaserGame.load.atlas("Male-Zombies-Gore","assets/tiles/POPHorrorCity_GFX/Graphics/Characters/Male_Zombies_Gore.png","assets/tiles/POPHorrorCity_GFX/Graphics/Characters/Male_Zombies_Gore.json",Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY),this.phaserGame.load.atlas("markers","assets/tiles/POPHorrorCity_GFX/Graphics/System/markers.png","assets/tiles/POPHorrorCity_GFX/Graphics/System/markers.json",Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY),this.gameService.LoadTileMap(t,this.phaserGame),this.phaserGame.load.audio("boden",["assets/sounds/essai.mp3"]),this.phaserGame.load.audio("soundeffect",["assets/sounds/soundeffect.ogg"]),this.phaserGame.load.atlas("candle-glow","assets/tiles/POPHorrorCity_GFX/Graphics/Characters/Objects/Candle_Glow.png","assets/tiles/POPHorrorCity_GFX/Graphics/Characters/Objects/Candle_Glow.json",Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY)},t.prototype.create=function(t){var e=this.phaserGame,i=e.add.audio("boden",1,!0),n=e.add.audio("soundeffect",.1,!0);this.gamegroup=e.add.group(),this.rangegroup=e.add.group(),this.visiongroup=e.add.group();var s=this.gamegroup;i.volume=.01,n.volume=0,e.camera.setPosition(32,32),n.allowMultiple=!0,n.addMarker("shotgun",10.15,.94),n.addMarker("gun",109.775,.55,.5),n.addMarker("grunt",197.618,.57),this.soundeffect=n,e.physics.startSystem(Phaser.Physics.ARCADE);var o=this.gameService.create(t,e,this.gamegroup),h=o.layers.get("collisions");this.map=o.map,this.tileMap=o.tileMap,this.collisionLayer=h,this.collisionLayer.resizeWorld(),this.cursors=e.input.keyboard.createCursorKeys(),this.wasd={cameraDown:e.input.keyboard.addKey(Phaser.Keyboard.NUMPAD_2),cameraUp:e.input.keyboard.addKey(Phaser.Keyboard.NUMPAD_8),cameraLeft:e.input.keyboard.addKey(Phaser.Keyboard.NUMPAD_4),cameraRight:e.input.keyboard.addKey(Phaser.Keyboard.NUMPAD_6),topTown:e.input.keyboard.addKey(Phaser.Keyboard.END)},this.visibleMarkerPool=new r.a(e,a.a,200,"visibleMarker"),this.marker=e.add.sprite(0,0,"markers"),s.add(this.marker),this.marker.animations.add("blink",["marker/blink1","marker/blink2"],5,!0),this.marker.play("blink"),e.physics.enable(this.marker,Phaser.Physics.ARCADE),this.glow=e.add.sprite(-100,-100,"markers"),s.add(this.glow),this.glow.animations.add("glow",["marker/active_entity"],5,!0),this.glow.play("glow"),e.physics.enable(this.glow,Phaser.Physics.ARCADE);var u=o.layers.get("example sprite");u.inputEnabled=!0,u.events.onInputDown.add(this.clickListener,this),this.debug&&(this.text=this.phaserGame.add.text(-100,-100,"",null)),this.o.next("ok")},t.prototype.removeAllAccessibleTiles=function(){this.rangegroup.removeAll()},t.prototype.addAccessibleTiles=function(t){var e=this;this.removeAllAccessibleTiles(),t.forEach(function(t){var i=e.phaserGame.add.sprite(t.x,t.y,"markers");e.rangegroup.add(i),i.animations.add("glow",["marker/accessible_tile"],5,!0),i.play("glow")})},t.prototype.removeVisibleTiles=function(t){var e=this;t.forEach(function(t){if(e.mapVisibleTileCount.has(t)){var i=0;e.mapVisibleTileCount.set(t,i),e.mapVisibleTile.get(t).alive=!1,e.mapVisibleTile.get(t).visible=!1}})},t.prototype.removeAllVisibleTiles=function(){this.mapVisibleTileCount=new Map,this.mapVisibleTile=new Map,this.visibleMarkerPool.sprites.forEach(function(t){t.alive=!1,t.visible=!1})},t.prototype.addVisibleTiles=function(t,e){var i=this,n=new Set,r=new Set;e.forEach(function(t){return r.add(t.x+":"+t.y)}),t.forEach(function(t){r.has(t.x+":"+t.y)||n.add(t.x+":"+t.y)}),this.removeVisibleTiles(Array.from(n)),e.forEach(function(t){var e=t.x+":"+t.y;i.mapVisibleTileCount.has(e)||i.mapVisibleTileCount.set(e,0);var r=i.mapVisibleTileCount.get(e);r<1&&i.mapVisibleTile.set(e,i.visibleMarkerPool.createNew(t.x,t.y,{})),n.has(e)||i.mapVisibleTileCount.set(e,r+1)})},t.prototype.createHuman=function(t){var e=this.phaserGame.add.sprite(t.x,t.y-32,"heroes-sprites");return e.animations.add("down",["sprite1","sprite2","sprite3"],5,!0),e.animations.add("left",["sprite13","sprite14","sprite15"],5,!0),e.animations.add("right",["sprite25","sprite26","sprite27"],5,!0),e.animations.add("up",["sprite37","sprite38","sprite39"],5,!0),e.animations.add("stand-down",["sprite2"],5,!0),e.play("stand-down"),this.gamegroup.add(e),e},t.prototype.createZombie=function(t,e){var i=this.phaserGame.add.sprite(t.x,t.y-32,"Male-Zombies-Gore"),n=3;i.smoothed=!1,i.scale.setTo(1,this.phaserGame.rnd.realInRange(.9,1.2));var r=this.phaserGame.rnd.integerInRange(0,50);s.a.addToAnimations(i.animations,r,"down",[e+"-down-1",e+"-down-2",e+"-down-3",e+"-down-2"],n,!0),i.animations.add("left",[e+"-left-1",e+"-left-2",e+"-left-3"],n,!0),i.animations.add("right",[e+"-right-1",e+"-right-2",e+"-right-3"],n,!0),i.animations.add("up",[e+"-up-1",e+"-up-2",e+"-up-3"],n,!0),i.animations.add("masked-down",["00-down-1","00-down-2","00-down-3"],n,!0),i.animations.add("masked-left",["00-left-1","00-left-2","00-left-3"],n,!0),i.animations.add("masked-right",["00-right-1","00-right-2","00-right-3"],n,!0),i.animations.add("masked-up",["00-up-1","00-up-2","00-up-3"],n,!0),i.play("down");var a=this.phaserGame.rnd.integerInRange(0,i.animations.currentAnim.frameTotal);return i.animations.currentAnim.setFrame(a),this.gamegroup.add(i),i},t.prototype.playSound=function(t){this.soundeffect.volume=.5,this.soundeffect.play(t)},t.prototype.clickListener=function(){var t=this.marker,e=new Phaser.Point;e.x=t.x,e.y=t.y,this.click(e)},t.prototype.overOffListener=function(){var t=this.marker,e=new Phaser.Point;e.x=t.x,e.y=t.y,this.overOff(e)},t.prototype.overListener=function(){var t=this.marker,e=new Phaser.Point;e.x=t.x,e.y=t.y,this.over(e)},t.prototype.setGlowPosition=function(t){this.phaserGame.tweens.removeAll(),this.glow.x=t.x,this.glow.y=t.y},t.prototype.moveGlowPosition=function(t){var e=this,i=this.phaserGame;this.glowTween&&this.glowTween.isRunning&&this.glowTween.stop(),this.glowTween=i.add.tween(this.glow).to({x:t.x,y:t.y},100,Phaser.Easing.Linear.None,!0),this.glowTween.onComplete.add(function(){return e.glowTween.stop()},this)},t.prototype.moveTo=function(t,e,i,n){var r=this,a=this.phaserGame;this.tween&&this.tween.isRunning&&this.tween.stop(),this.tween=a.add.tween(t).to({x:e,y:i-32},100,Phaser.Easing.Linear.None,!0),this.tween.onComplete.add(function(){return r.onComplete(t,n)},this)},t.prototype.lookTo=function(t,e){t.play(e)},t.prototype.onComplete=function(t,e){e()},t.prototype.getTopDownCameraPositionY=function(){var t=this.phaserGame,e=t.camera;return e.bounds.bottom-e.height/2},t.prototype.updateCamera=function(){var t=this.phaserGame,e=t.camera,i=t.input.activePointer,n=e.position,r=32,a=16;if(i.x<=r)this.phaserGame.camera.setPosition(n.x-a,n.y);else if(i.y<=r)this.phaserGame.camera.setPosition(n.x,n.y-a);else if(i.x>=e.width-r)this.phaserGame.camera.setPosition(n.x+a,n.y);else if(i.y>=e.height-r){var s=Math.min(n.y+a,this.getTopDownCameraPositionY());this.phaserGame.camera.setPosition(n.x,s)}},t.prototype.isPositionCollidable=function(t){var e=this.getTileAtPosition(t);return e&&e.properties.cantGo},t.prototype.getPositionCover=function(t){var e=this.getTileAtPosition(t);return e&&e.properties.cover?e.properties.cover:0},t.prototype.getPositionMask=function(t){var e=this.getTileAtPosition(t);return!(!e||!e.properties.mask)},t.prototype.getTileAtPosition=function(t){return this.map.getTileWorldXY(t.x,t.y,16,16,this.collisionLayer)},t.prototype.setMarker=function(){var t=this.marker,e=this.pointToTilePosition();if(this.isPositionCollidable(e));else{t.x=e.x,t.y=e.y;var i=t.x/32+":"+t.y/32,n=(new Date).getTime(),r=n-this.overTimer.time;this.overTimer.key==i?r>300?this.overTimer.tick||(this.overListener(),this.overTimer.tick=!0,this.overTimer.wasOver=!0,this.debug&&(this.text.destroy(),this.text=this.phaserGame.add.text(t.x,t.y,i,null),this.text.font="Roboto",this.text.fontSize=12)):(this.text.destroy(),this.overTimer.tick=!1):(this.text.destroy(),this.overTimer.key=i,this.overTimer.time=n,this.overTimer.tick=!1,this.overTimer.wasOver&&(this.overOffListener(),this.overTimer.wasOver=!1))}},t.prototype.pointToTilePosition=function(){var t=this.phaserGame,e=t.camera,i=t.input.activePointer,n=e.position,r=32,a=new Phaser.Point;return a.x=r*Math.round((i.x+n.x-16)/r),a.y=r*Math.round((i.y+n.y-16)/r),a},t.prototype.handlerKeyBoard=function(){var t=this.phaserGame.camera,e=t.position;this.wasd.cameraDown.isDown&&this.phaserGame.camera.setPosition(e.x,e.y+5),this.wasd.cameraLeft.isDown&&this.phaserGame.camera.setPosition(e.x-5,e.y),this.wasd.cameraRight.isDown&&this.phaserGame.camera.setPosition(e.x+5,e.y),this.wasd.cameraUp.isDown&&this.phaserGame.camera.setPosition(e.x,e.y-5),this.wasd.topTown.isDown&&this.phaserGame.camera.setPosition(e.x,t.bounds.bottom-t.height/2)},t.prototype.update=function(){this.setMarker(),this.updateCamera(),this.handlerKeyBoard()},t}()},297:function(t,e,i){"use strict";i.d(e,"a",function(){return r});var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=function(t){function e(e,i,n,r){t.call(this,e,e.world,r,!1,!0,Phaser.Physics.ARCADE),this.spriteType=i,this.initializePool(n)}return n(e,t),e.prototype.initializePool=function(t){if(this.sprites=new Array,!(t<=0))for(var e=0;e<t;e++){var i=this.add(new this.spriteType(this.game));i.poolId=e,this.sprites.push(i)}},e.prototype.createNew=function(t,e,i){var n=this.getFirstDead(!1);return n||(console.log("createNew"),n=new this.spriteType(this.game),this.add(n,!0)),n.spawn(t,e,i),n},e}(Phaser.Group)},298:function(t,e,i){"use strict";i.d(e,"a",function(){return r});var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=function(t){function e(e,i,n,r){t.call(this,e,i,n,r)}return n(e,t),e.prototype.spawn=function(t,e,i){this.stdReset(t,e)},e.prototype.stdReset=function(t,e){this.reset(t,e),this.exists=!0,this.alive=!0},e}(Phaser.Sprite)},299:function(t,e,i){"use strict";i.d(e,"a",function(){return n});var n={production:!0}},369:function(t,e,i){t.exports=i(213)}},[369]);